<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚ ì§œ ê³„ì‚°ê¸° & ë°”ì½”ë“œ ìƒì„±ê¸°</title>

<!-- FontAwesome ì•„ì´ì½˜ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- JsBarcode / Tesseract -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<style>
body {
  font-family: 'Pretendard', 'Arial', sans-serif;
  background: linear-gradient(135deg, #f0f4ff, #fafafa);
  margin: 0;
  padding: 20px;
  text-align: center;
}
header {
  font-size: 1.5em;
  color: #333;
  margin-bottom: 15px;
  font-weight: bold;
}
.toggle-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}
.toggle-buttons button {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 10px 18px;
  cursor: pointer;
  font-size: 16px;
  box-shadow: 2px 3px 6px rgba(0,0,0,0.15);
  transition: 0.3s;
}
.toggle-buttons button.active {
  background: linear-gradient(135deg, #2563eb, #1e40af);
  transform: scale(1.05);
}
.toggle-buttons button:hover {
  opacity: 0.9;
}
.section {
  display: none;
  background-color: white;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: 20px;
  max-width: 500px;
  margin: auto;
}
.section.active {
  display: block;
}
input, button.action {
  border-radius: 8px;
  border: 1px solid #ccc;
  padding: 8px;
  width: 90%;
  margin: 6px auto;
  display: block;
  font-size: 15px;
}
button.action {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
  font-weight: bold;
  cursor: pointer;
  border: none;
  transition: 0.3s;
}
button.action:hover {
  background: linear-gradient(135deg, #2563eb, #1e40af);
}
#preview {
  width: 100%;
  max-width: 420px;
  height: 240px;
  border: 2px dashed #aaa;
  border-radius: 12px;
  background-color: #f5f5f5;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 10px auto;
  color: #777;
  font-size: 15px;
}
#preview img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 10px;
}
#barcodeList div {
  border: 1px solid #ddd;
  border-radius: 10px;
  background-color: #f9fafb;
  padding: 10px;
  margin: 8px auto;
  width: 90%;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.message {
  color: #888;
  font-style: italic;
}
</style>
</head>

<body>
<header><i class="fa-solid fa-calendar-days"></i> ë‚ ì§œ ê³„ì‚°ê¸° & <i class="fa-solid fa-barcode"></i> ë°”ì½”ë“œ ìƒì„±ê¸°</header>

<div class="toggle-buttons">
  <button id="dateBtn" class="active" onclick="showSection('dateSection', this)">
    <i class="fa-regular fa-calendar"></i> ë‚ ì§œ ê³„ì‚°ê¸°
  </button>
  <button id="barcodeBtn" onclick="showSection('barcodeSection', this)">
    <i class="fa-solid fa-barcode"></i> ë°”ì½”ë“œ ìƒì„±ê¸°
  </button>
</div>

<!-- ë‚ ì§œ ê³„ì‚°ê¸° -->
<div id="dateSection" class="section active">
  <h3><i class="fa-regular fa-calendar-check"></i> ë‚ ì§œ ê³„ì‚°ê¸°</h3>
  <input type="date" id="baseDate">
  <input type="number" id="addDays" placeholder="ì¼ìˆ˜ ì…ë ¥"> 
  <input type="number" id="addMonths" placeholder="ì›”ìˆ˜ ì…ë ¥"> 
  <input type="number" id="addYears" placeholder="ë…„ìˆ˜ ì…ë ¥">
  <button class="action" onclick="calculateDate()">ê³„ì‚°í•˜ê¸°</button>
  <button class="action" onclick="getLastDay()">ë‹¬ ë§ì¼ í™•ì¸</button>
  <p id="result"></p>
</div>

<!-- ë°”ì½”ë“œ ìƒì„±ê¸° -->
<div id="barcodeSection" class="section">
  <h3><i class="fa-solid fa-barcode"></i> ë°”ì½”ë“œ ìƒì„±ê¸°</h3>
  <input type="file" accept="image/*" onchange="loadImage(event)">
  <div id="preview">ë¶ˆëŸ¬ì˜¨ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  <p id="ocrResult" class="message"></p>

  <input type="text" id="manualCode" placeholder="ë°”ì½”ë“œ ë²ˆí˜¸ (ìë™ ë˜ëŠ” ìˆ˜ë™ ì…ë ¥)">
  <input type="text" id="company" placeholder="ì—…ì²´ëª… ì…ë ¥">
  <button class="action" onclick="generateBarcode()">ë°”ì½”ë“œ ìƒì„±</button>
  <svg id="barcode"></svg>

  <h4>ğŸ“¦ ì €ì¥ëœ ë°”ì½”ë“œ ëª©ë¡</h4>
  <div id="barcodeList"></div>
  <button class="action" onclick="downloadAll()">ëª¨ë‘ ë‹¤ìš´ë¡œë“œ</button>
</div>

<script>
function showSection(id, btn) {
  document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.toggle-buttons button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function calculateDate() {
  const base = new Date(document.getElementById('baseDate').value);
  if (isNaN(base)) {
    document.getElementById('result').innerText = "ê¸°ì¤€ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.";
    return;
  }
  let days = parseInt(document.getElementById('addDays').value) || 0;
  let months = parseInt(document.getElementById('addMonths').value) || 0;
  let years = parseInt(document.getElementById('addYears').value) || 0;
  base.setFullYear(base.getFullYear() + years);
  base.setMonth(base.getMonth() + months);
  base.setDate(base.getDate() + days - 1);
  document.getElementById('result').innerText = 
    "ê²°ê³¼ ë‚ ì§œ: " + base.toISOString().split('T')[0];
}

function getLastDay() {
  const base = new Date(document.getElementById('baseDate').value);
  if (isNaN(base)) {
    document.getElementById('result').innerText = "ê¸°ì¤€ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.";
    return;
  }
  const lastDay = new Date(base.getFullYear(), base.getMonth() + 1, 0);
  document.getElementById('result').innerText =
    `${base.getFullYear()}ë…„ ${base.getMonth()+1}ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì€ ${lastDay.getDate()}ì¼ì…ë‹ˆë‹¤.`;
}

// -------------------- ë°”ì½”ë“œ ìƒì„±ê¸° --------------------
let loadedImage = null;

function loadImage(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('preview');
  if (!file) {
    preview.innerHTML = "ë¶ˆëŸ¬ì˜¨ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }
  const reader = new FileReader();
  reader.onload = function(e) {
    preview.innerHTML = `<img src="${e.target.result}">`;
    loadedImage = e.target.result;
    document.getElementById('ocrResult').innerText = "ì´ë¯¸ì§€ ì¸ì‹ ì¤‘...";
    Tesseract.recognize(e.target.result, 'eng+kor').then(({ data: { text } }) => {
      const cleanText = text.replace(/\s+/g, '');
      if (cleanText.length > 0) {
        document.getElementById('ocrResult').innerText = "ì½ì€ ë°”ì½”ë“œ: " + cleanText;
        document.getElementById('manualCode').value = cleanText;
      } else {
        document.getElementById('ocrResult').innerText = "ë°”ì½”ë“œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
      }
    }).catch(() => {
      document.getElementById('ocrResult').innerText = "ì´ë¯¸ì§€ë¥¼ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
    });
  };
  reader.readAsDataURL(file);
}

function generateBarcode() {
  const code = document.getElementById('manualCode').value.trim();
  const company = document.getElementById('company').value.trim();
  if (!code) {
    alert("ë°”ì½”ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }
  JsBarcode("#barcode", code, { format: "CODE128", displayValue: true });
  const barcodeList = document.getElementById('barcodeList');
  const div = document.createElement('div');
  const uniqueId = "svg" + Date.now();
  div.innerHTML = `<strong>${company || 'ì—…ì²´ ë¯¸ì…ë ¥'}</strong><br>
    <svg id="${uniqueId}"></svg><br>${code}`;
  barcodeList.prepend(div);
  JsBarcode(`#${uniqueId}`, code, { format: "CODE128", displayValue: true });
}

function downloadAll() {
  const items = document.getElementById('barcodeList').innerHTML;
  const blob = new Blob([items], { type: "text/html" });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "barcodes.html";
  a.click();
}
</script>
</body>
</html>
